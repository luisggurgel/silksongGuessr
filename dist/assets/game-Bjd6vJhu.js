var V=Object.defineProperty;var U=(t,e,a)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var k=(t,e,a)=>U(t,typeof e!="symbol"?e+"":e,a);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{g as Z}from"./api-Lm5KxLvI.js";const H="modulepreload",j=function(t){return"/"+t},W={},q=function(e,a,s){let o=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=Promise.allSettled(a.map(d=>{if(d=j(d),d in W)return;W[d]=!0;const h=d.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":H,h||(m.as="script"),m.crossOrigin="",m.href=d,l&&m.setAttribute("nonce",l),document.head.appendChild(m),h)return new Promise((g,L)=>{m.addEventListener("load",g),m.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return o.then(c=>{for(const l of c||[])l.status==="rejected"&&n(l.reason);return e().catch(n)})};function F(t,e,a){return t*(1-a)+e*a}function z(t,e){return t===e?t:Math.floor(Math.random()*(e-t+1)+t)}function K(t){let e=2166136261;for(let a=0;a<t.length;a++)e^=t.charCodeAt(a),e=Math.imul(e,16777619)>>>0;return e>>>0}class J{constructor(e){typeof e=="string"?this.state=K(e)||1:typeof e=="number"?this.state=e>>>0||1:this.state=1}next(){let e=(this.state+=1831565813)>>>0;return e=Math.imul(e^e>>>15,e|1)>>>0,e^=e+Math.imul(e^e>>>7,e|61)>>>0,((e^e>>>14)>>>0)/4294967296}randIRange(e,a){return e===a?e:Math.floor(this.next()*(a-e+1))+e}shuffle(e){for(let a=e.length-1;a>0;a--){const s=Math.floor(this.next()*(a+1)),o=e[a];e[a]=e[s],e[s]=o}return e}}function Q(t){return new J(t)}function N(t){return new Promise((e,a)=>{if(t.complete&&t.naturalWidth!==0){e(t);return}t.onload=()=>e(t),t.onerror=s=>a(new Error(`Failed to load image: ${t.src}, ${s}`))})}class I{static async preloadSound(e){if(!this._cache.has(e)){const a=new Audio(e);a.preload="auto",await new Promise((s,o)=>{a.addEventListener("canplaythrough",s),a.addEventListener("error",o)}),this._cache.set(e,a)}}static playSound(e,a=0,s=!1,o=!1){let n;if(this._cache.has(e)?n=this._cache.get(e).cloneNode():n=new Audio(e),n.loop=s,this._playing.add(n),n.addEventListener("ended",()=>this._playing.delete(n)),n.addEventListener("pause",()=>{n.loop||this._playing.delete(n)}),a>0){n.volume=0;const c=20,l=a/c,d=setInterval(()=>{n.volume>=1?clearInterval(d):n.volume=Math.min(1,n.volume+1/c)},l);o&&s&&n.addEventListener("timeupdate",()=>{const h=n.duration-n.currentTime;h<=a&&(n.volume=Math.max(0,h/a))})}n.play().catch(c=>{console.warn(`Failed to play sound "${e}"`,c),this._playing.delete(n)})}static stopAll(){this._playing.forEach(e=>{e.pause(),e.currentTime=0}),this._playing.clear()}}k(I,"_cache",new Map),k(I,"_playing",new Set);const ee=4498,te=2901,p={canvas:null,ctx:null,gameManager:null,mapWidth:ee,mapHeight:te,mapImg:new Image,knightPinImg:new Image,shadePinImg:new Image,camera:{x:0,y:0,targetX:0,targetY:0,zoom:.125,targetZoom:.125},mousePos:{x:0,y:0},mouseXRelative:0,mouseYRelative:0,isDragging:!1,dragStart:{x:0,y:0},hasMoved:!1,initialZoom:0,pinchStartDistance:0,zoomFocus:{x:0,y:0},isProgrammaticZoom:!1,guessPosition:null,lastFrameTime:0,fps:0,get mapCenter(){return{x:this.mapWidth/2,y:this.mapHeight/2}},init(t,e){this.canvas=t,this.gameManager=e,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!0,this.knightPinImg.src="/images/knightPin.png",this.shadePinImg.src="/images/shadePin.png",Promise.all([N(this.knightPinImg),N(this.shadePinImg)]).catch(a=>{console.error("Failed to load one or more pin images:",a)}),this.addEventListeners(),this.resetCamera()},async changeMapImage(t,e){const a=document.getElementById("mapLoadingText");try{a&&(a.style.display="block"),this.mapImg.src=t,await N(this.mapImg),this.mapWidth=this.mapImg.width,this.mapHeight=this.mapImg.height,this.currentMapUrl=t,console.log(`Image loaded: ${t} (${this.mapWidth}x${this.mapHeight})`),this.resetCamera(),this.draw(),e&&e()}catch(s){console.error("Failed to load map image:",s)}finally{a&&(a.style.display="none")}},addEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this))},handleMouseDown(t){if(document.body.classList.contains("modal-open"))return;const e=this.canvas.getBoundingClientRect();this.mousePos.x=t.clientX-e.left,this.mousePos.y=t.clientY-e.top,this.updateRelativeMousePos(),this.isDragging=!0,this.hasMoved=!1,this.dragStart.x=t.clientX,this.dragStart.y=t.clientY},handleMouseMove(t){if(document.body.classList.contains("modal-open"))return;const e=this.canvas.getBoundingClientRect();if(this.mousePos.x=t.clientX-e.left,this.mousePos.y=t.clientY-e.top,this.updateRelativeMousePos(),this.isDragging){const a=(t.clientX-this.dragStart.x)/this.camera.zoom,s=(t.clientY-this.dragStart.y)/this.camera.zoom;(a!==0||s!==0)&&(this.hasMoved=!0),this.camera.x+=a,this.camera.y+=s,this.camera.targetX=this.camera.x,this.camera.targetY=this.camera.y,this.dragStart.x=t.clientX,this.dragStart.y=t.clientY}},handleMouseUp(){if(console.log("GameMap: handleMouseUp attempt",{bodyClass:document.body.className,hasMoved:this.hasMoved,gameState:this.gameManager.gameState,EXPECTED_STATE:u.guessing}),document.body.classList.contains("modal-open")){this.isDragging=!1;return}!this.hasMoved&&this.gameManager.gameState===u.guessing?(console.log("GameMap: Calling updateGuessPos"),this.updateGuessPos(this.mouseXRelative,this.mouseYRelative)):console.log("GameMap: Click ignored because",this.hasMoved?"Map was dragged":"GameState is not guessing"),this.isDragging=!1},handleMouseLeave(){this.isDragging=!1},handleWheel(t){if(document.body.classList.contains("modal-open"))return;t.preventDefault();const e=this.canvas.getBoundingClientRect(),a=t.clientX-e.left,s=t.clientY-e.top;this.zoomFocus.x=a,this.zoomFocus.y=s;const o=Math.exp(-t.deltaY*.001),n=Math.min(Math.max(this.camera.targetZoom*o,.1),5);n!==this.camera.targetZoom&&(this.isProgrammaticZoom=!1),this.camera.targetZoom=n},handleTouchStart(t){document.body.classList.contains("modal-open")||(t.touches.length===1?(this.isDragging=!0,this.hasMoved=!1,this.dragStart.x=t.touches[0].clientX,this.dragStart.y=t.touches[0].clientY):t.touches.length===2&&(this.isDragging=!1,this.pinchStartDistance=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY),this.initialZoom=this.camera.targetZoom))},handleTouchMove(t){if(!document.body.classList.contains("modal-open")){if(t.touches.length===1&&this.isDragging){const e=this.canvas.getBoundingClientRect();this.mousePos.x=t.touches[0].clientX-e.left,this.mousePos.y=t.touches[0].clientY-e.top,this.updateRelativeMousePos();const a=(t.touches[0].clientX-this.dragStart.x)/this.camera.zoom,s=(t.touches[0].clientY-this.dragStart.y)/this.camera.zoom;(a!==0||s!==0)&&(this.hasMoved=!0),this.camera.x+=a,this.camera.y+=s,this.camera.targetX=this.camera.x,this.camera.targetY=this.camera.y,this.dragStart.x=t.touches[0].clientX,this.dragStart.y=t.touches[0].clientY}else if(t.touches.length===2){const e=this.canvas.getBoundingClientRect(),a=t.touches[0],s=t.touches[1],o=(a.clientX+s.clientX)/2-e.left,n=(a.clientY+s.clientY)/2-e.top;this.zoomFocus.x=o,this.zoomFocus.y=n;const l=Math.hypot(a.clientX-s.clientX,a.clientY-s.clientY)/this.pinchStartDistance,d=Math.min(Math.max(this.initialZoom*l,.1),5);d!==this.camera.targetZoom&&(this.isProgrammaticZoom=!1),this.camera.targetZoom=d}}},handleTouchEnd(){if(document.body.classList.contains("modal-open")){this.isDragging=!1;return}!this.hasMoved&&GameManager.gameState===u.guessing&&this.updateGuessPos(this.mouseXRelative,this.mouseYRelative),this.isDragging=!1},updateRelativeMousePos(){const t=this.canvas.getBoundingClientRect();this.mouseXRelative=(this.mousePos.x-t.width/2)/this.camera.zoom-this.camera.x,this.mouseYRelative=(this.mousePos.y-t.height/2)/this.camera.zoom-this.camera.y},updateGuessPos(t,e){this.guessPosition={x:t,y:e},i.guessButton.disabled=!1,I.playSound("audio/pin_drop.ogg")},draw(){const t=performance.now();if(this.lastFrameTime){const m=t-this.lastFrameTime;m>0&&(this.fps=1e3/m)}this.lastFrameTime=t;const e=window.devicePixelRatio||1,a=this.canvas.getBoundingClientRect(),s=a.width,o=a.height;(this.canvas.width!==s*e||this.canvas.height!==o*e)&&(this.canvas.width=s*e,this.canvas.height=o*e),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.scale(e,e);const n=this.camera.zoom;if(this.camera.x=F(this.camera.x,this.camera.targetX,.5),this.camera.y=F(this.camera.y,this.camera.targetY,.5),this.camera.zoom=F(this.camera.zoom,this.camera.targetZoom,.25),n!==this.camera.zoom&&!this.isProgrammaticZoom){const m=(this.zoomFocus.x-s/2)/n-this.camera.x,g=(this.zoomFocus.y-o/2)/n-this.camera.y;this.camera.x=(this.zoomFocus.x-s/2)/this.camera.zoom-m,this.camera.y=(this.zoomFocus.y-o/2)/this.camera.zoom-g,this.camera.targetX=this.camera.x,this.camera.targetY=this.camera.y}if(this.ctx.translate(s/2,o/2),this.ctx.scale(this.camera.zoom,this.camera.zoom),this.ctx.translate(this.camera.x,this.camera.y),!this.mapImg||!this.mapImg.complete||!this.mapImg.naturalWidth){this.ctx.restore();return}const c={left:-this.camera.x-s/2/this.camera.zoom,right:-this.camera.x+s/2/this.camera.zoom,top:-this.camera.y-o/2/this.camera.zoom,bottom:-this.camera.y+o/2/this.camera.zoom},l=Math.max(0,c.left),d=Math.max(0,c.top),h=Math.min(this.mapWidth,c.right)-l,f=Math.min(this.mapHeight,c.bottom)-d;if(h<=0||f<=0){this.ctx.restore();return}this.ctx.drawImage(this.mapImg,l,d,h,f,l,d,h,f),this.guessPosition&&((this.gameManager.gameState===u.guessed||this.gameManager.gameState===u.gameOver)&&(this.ctx.beginPath(),this.ctx.moveTo(this.guessPosition.x,this.guessPosition.y),this.ctx.lineTo(this.gameManager.currentLocation[0],this.gameManager.currentLocation[1]),this.ctx.strokeStyle="red",this.ctx.lineWidth=10/this.camera.zoom,this.ctx.stroke(),this.ctx.save(),this.ctx.translate(this.gameManager.currentLocation[0],this.gameManager.currentLocation[1]),this.ctx.scale(.5/this.camera.zoom,.5/this.camera.zoom),this.ctx.drawImage(this.shadePinImg,-this.shadePinImg.width/2,-this.shadePinImg.height/2),this.ctx.restore()),this.ctx.save(),this.ctx.translate(this.guessPosition.x,this.guessPosition.y),this.ctx.scale(.5/this.camera.zoom,.5/this.camera.zoom),this.ctx.drawImage(this.knightPinImg,-this.knightPinImg.width/2,-this.knightPinImg.height/2),this.ctx.restore()),this.ctx.restore()},resetCamera(){this.camera.targetX=-this.mapCenter.x,this.camera.targetY=-this.mapCenter.y,this.camera.targetZoom=.125},setCameraTarget(t,e,a){this.camera.targetX=-t,this.camera.targetY=-e,this.camera.targetZoom=a},fitPointsInView(t,e,a=100){this.isProgrammaticZoom=!0;const s=(t.x+e.x)/2,o=(t.y+e.y)/2;this.camera.targetX=-s,this.camera.targetY=-o;const n=Math.abs(t.x-e.x),c=Math.abs(t.y-e.y),l=this.canvas.getBoundingClientRect(),d=l.width,h=l.height,f=d/(n+a*2),m=h/(c+a*2);this.camera.targetZoom=Math.min(f,m,2)},calculateDistance(t,e){const a=Array.isArray(t)?t[0]:t.x,s=Array.isArray(t)?t[1]:t.y,o=Array.isArray(e)?e[0]:e.x,n=Array.isArray(e)?e[1]:e.y;return Math.hypot(o-a,n-s)}};let G=[];const B="data/defaultImagePacks/";async function X(t,e,a,s=!1){const o={name:t.name,locations:e,map:a};if(s)if(typeof b.usedLocations<"u")b.usedLocations[t.gameModeId]=[];else if(console.warn("GameManager.usedLocations not initialized yet, attempting to wait..."),await new Promise(l=>setTimeout(l,100)),typeof b.usedLocations<"u")b.usedLocations[t.gameModeId]=[];else throw new Error("GameManager.usedLocations is not available. Ensure the game has fully loaded.");let n="custom";t.map.defaultMap==="images/game/defaultMaps/pharloom.png"&&(n="pharloom"),t.map.defaultMap==="images/game/defaultMaps/hallownest.png"&&(n="hallownest");const c={id:t.gameModeId,value:t.gameModeId,label:s?`${t.name} (Custom)`:t.name,img:t.thumbnail,description:t.description||"",author:t.author||"Unknown",imageCount:e.length,gameMapName:n};return w.addChoice(c),console.log("Pack Registered:",c.id),o}async function ie(t){try{const e=await JSZip.loadAsync(await t.arrayBuffer()),a=e.file("pack.json");if(!a)throw new Error("pack.json not found in zip");const s=JSON.parse(await a.async("text"));if(s.thumbnail){const l=e.file(s.thumbnail);if(l){const d=await l.async("blob");s.thumbnail=URL.createObjectURL(d)}else console.warn(`Thumbnail '${s.thumbnail}' not found in zip.`)}const o=await Promise.all(s.locations.map(async l=>{if(/^(https?:)?\/\//.test(l.image)||l.image.startsWith("blob:"))return[l.x,l.y,l.difficulty,l.image];const d=l.image.split("/").pop(),h=e.file(`images/${d}`);if(!h)throw new Error(`Image ${d} not found in zip`);const f=new Blob([await h.async("arraybuffer")]);return[l.x,l.y,l.difficulty,URL.createObjectURL(f)]}));let n={useCustomMap:!1,defaultMap:R};if(s.map)if(s.map.useCustomMap){const l=e.file(s.map.mapImage);if(!l)throw new Error(`Map image ${s.map.mapImage} not found in zip`);const d=new Blob([await l.async("arraybuffer")]);n={useCustomMap:!0,mapUrl:URL.createObjectURL(d)}}else s.map.defaultMap&&(n.defaultMap=s.map.defaultMap);const c=await X(s,o,n,!0);b.addGameModeData(s.gameModeId,c)}catch(e){console.error("Error loading custom image pack:",e),alert(`Error loading image pack: ${e.message}`)}}async function ae(){try{const e=await fetch("data/defaultImagePacks/packList.json");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);G=await e.json()}catch(e){console.error("Failed to load or parse data:",e),G=[]}const t={};try{for(const e of G)try{const a=await fetch(`${B}${e}/pack.json`);if(!a.ok){console.error(`Failed to load ${e} pack.json`);continue}const s=await a.json();s.thumbnail&&!/^(https?:)?\/\//.test(s.thumbnail)&&(s.thumbnail=`${B}${e}/${s.thumbnail}`);const o=s.locations.map(l=>{if(/^(https?:)?\/\//.test(l.image)||l.image.startsWith("blob:"))return[l.x,l.y,l.difficulty,l.image];const d=l.image.split("/").pop();return[l.x,l.y,l.difficulty,`${B}${e}/images/${d}`]});let n={useCustomMap:!1,defaultMap:R};s.map&&(s.map.useCustomMap?n={useCustomMap:!0,mapUrl:`${B}${e}/${s.map.mapImage}`}:s.map.defaultMap&&(n.defaultMap=s.map.defaultMap));const c=await X(s,o,n,!1);t[s.gameModeId]=c}catch(a){console.error(`Error loading ${e} pack:`,a)}return w.hasSelection()==!1&&w.selectChoiceByIndex(0),t}catch(e){return console.error("Error loading location data:",e),{}}}const Y=document.getElementById("customImagePack");Y&&Y.addEventListener("change",async t=>{const e=t.target.files[0];if(e){if(!e.name.endsWith(".zip")){alert("Please select a ZIP file"),t.target.value="";return}await ie(e),t.target.value=""}});class se{constructor(e,a=[]){this.container=e,this.options=a,this.selected=new Set,this.render()}render(){this.container.innerHTML="",this.container.classList.add("choices"),this.options.forEach(e=>{const a=document.createElement("div");a.className="choice",this.selected.has(e.id)&&a.classList.add("selected");const s=document.createElement("img");s.classList.add("choice-img"),s.onerror=function(){this.src="images/noThumbnail.svg",this.alt="No Thumbnail"},e.img?s.src=e.img:(s.src="images/noThumbnail.svg",s.alt="No Thumbnail"),a.appendChild(s);const o=document.createElement("div");o.classList.add("choiceTextContainer");const n=document.createElement("div");if(n.className="choice-info",e.author){const l=document.createElement("span");l.className="choice-author",l.textContent=`By ${e.author}`,n.appendChild(l)}if(e.imageCount!==void 0){const l=document.createElement("span");l.className="choice-image-count",l.textContent=`${e.imageCount} images`,n.appendChild(l)}const c=document.createElement("span");if(c.className="choice-label",c.textContent=e.label,e.gameMapName){const l=document.createElement("img");e.gameMapName==="hallownest"?l.src="images/knightPin.png":e.gameMapName==="pharloom"?l.src="images/hornetPin.png":l.src="images/customPin.png",l.className="choice-map-icon",o.appendChild(l)}o.appendChild(c),o.appendChild(n),a.appendChild(o),this.container.appendChild(a),a.addEventListener("click",()=>{this.selected.has(e.id)?(this.selected.delete(e.id),a.classList.remove("selected"),b.saveOptionsToLocalStorage()):(this.selected.add(e.id),a.classList.add("selected"),b.saveOptionsToLocalStorage())})})}selectChoiceByIndex(e){if(e>=0&&e<this.options.length){const a=this.options[e];this.selected.add(a.id),this.render()}}getSelected(){return Array.from(this.selected)}getSelectedOptions(){return this.options.filter(e=>this.selected.has(e.id))}addChoice(e){this.options.push(e),this.render()}removeChoiceById(e){this.options=this.options.filter(a=>a.id!==e),this.selected.delete(e),this.render()}clearChoices(){this.options=[],this.selected.clear(),this.render()}hasSelection(){return this.selected.size>0}}class oe{constructor(){this.windows=new Map,this.modalOverlay=document.getElementById("modalOverlay"),this.currentlyOpen=null,document.addEventListener("keydown",e=>{const a=this.windows.get(this.currentlyOpen);e.key==="Escape"&&(a!=null&&a.closeOnEscape)&&this.close()})}add({id:e,element:a,onOpen:s=()=>{},closeOnEscape:o=!1}){if(!a){console.error(`WindowManager: Element for window with id "${e}" not found.`);return}this.windows.set(e,{element:a,onOpen:s,closeOnEscape:o})}open(e){var n;this.currentlyOpen&&((n=this.windows.get(this.currentlyOpen))==null||n.element.classList.remove("visible"));const a=this.windows.get(e);if(!a){console.error(`WindowManager: Window with id "${e}" not found.`);return}const{element:s,onOpen:o}=a;document.body.classList.add("modal-open"),this.modalOverlay&&this.modalOverlay.classList.add("visible"),s.style.display="flex",setTimeout(()=>{s.classList.add("visible"),this.currentlyOpen=e,o();const c=s.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');c.length>0&&c[0].focus()},10)}close(){var o,n;if(!this.currentlyOpen)return;const e=this.windows.get(this.currentlyOpen);e&&(e.element.classList.remove("visible"),e.element.addEventListener("transitionend",()=>{e.element.classList.contains("visible")||(e.element.style.display="none")},{once:!0})),this.currentlyOpen=null;const a=((o=document.getElementById("loadingText"))==null?void 0:o.style.display)!=="none",s=((n=document.getElementById("mapLoadingText"))==null?void 0:n.style.display)!=="none";!a&&!s&&(document.body.classList.remove("modal-open"),this.modalOverlay&&this.modalOverlay.classList.remove("visible"))}}class ne{constructor(){k(this,"displayToast",(e,a=5e3,{allowHTML:s=!1}={})=>{const o=document.createElement("div");return o.className="hk_toast",s?o.innerHTML=e:o.textContent=e,this.toastContainer.appendChild(o),o.offsetHeight,o.style.opacity="1",a&&setTimeout(()=>{this.dismissToast(o)},a),o});k(this,"dismissToast",e=>{!e||!e.parentNode||(e.style.opacity="0",e.addEventListener("transitionend",()=>{e.remove()}))});this.toastContainer=document.createElement("div"),this.toastContainer.id="toast-container",document.body.appendChild(this.toastContainer)}}window.debugMode=!1;const R="images/game/defaultMaps/hallownest.png",w=new se(r("packChoices")),u={guessing:0,guessed:1,gameOver:2,gameMenu:3},le={attuned:{min:1,max:4},ascended:{min:4,max:7},radiant:{min:7,max:10}},S=new ne,v=new oe,i={},b={gameState:u.gameMenu,usedLocations:{},playOrders:{},playOrderPointers:{},currentLocation:null,currentRound:0,totalRounds:5,totalScore:0,roundScore:0,maxScore:5e3,lastFrameTime:0,timerLengthSeconds:60,timeLimitEnabled:!1,endTime:0,blurredModeEnabled:!1,blurTimeRemaining:0,totalBlurTime:2e4,imageIsLoaded:!1,seed:null,rng:null,minDifficulty:1,maxDifficulty:10,gameModeData:{},speedrunTimer:{_currentLocationTime:0,set currentLocationTime(t){this._currentLocationTime=t,r("locationTime").innerText=(t/1e3).toFixed(2)},get currentLocationTime(){return this._currentLocationTime},_totalTime:0,set totalTime(t){this._totalTime=t,r("totalTime").innerText=(t/1e3).toFixed(2)},get totalTime(){return this._totalTime}},init(t){I.preloadSound("audio/pin_drop.ogg"),I.preloadSound("audio/confirm.ogg"),I.preloadSound("audio/basic_button.ogg"),this.gameModeData=t,p.init(i.mapCanvas,this),Object.keys(this.gameModeData).forEach(s=>{this.usedLocations[s]||(this.usedLocations[s]=[])}),this.loadOptionsFromLocalStorage(),v.add({id:"options",element:i.gameOptionsWindow,onOpen:()=>{this.updateSelectedPacksDisplay(),this.gameState=u.gameMenu,i.startButton.innerText="Start Game",this.validaiteForm()}}),v.add({id:"gameover",element:i.gameOverWindow,onOpen:()=>{this.gameState=u.gameOver}}),v.add({id:"packChoices",element:i.packSelectWindow,onOpen:()=>{this.gameState=u.gameMenu}}),v.add({id:"confirmation",element:i.confirmationWindow,closeOnEscape:!0}),new URLSearchParams(window.location.search).get("mode")==="play"?this.restartGame().then(s=>{s||(console.warn("Could not auto-start, opening options instead."),v.open("options"))}):v.open("options"),this.setLocation(z(0,this.gameModeData.hallownest.locations.length),"hallownest",!1),this.addEventListeners(),this.gameLoop(),this.initializeOptionToggles()},addGameModeData(t,e){this.gameModeData[t]=e,this.usedLocations[t]=[]},gameLoop(){const t=performance.now(),e=this.lastFrameTime>0?t-this.lastFrameTime:0;if(this.lastFrameTime=t,this.gameState===u.guessing){if(this.speedrunTimer.currentLocationTime+=e,this.speedrunTimer.totalTime+=e,this.timeLimitEnabled){const a=this.endTime-t;a<=0?(i.timeLimitDisplay.innerText="0.00",p.guessPosition||p.updateGuessPos(p.mouseXRelative,p.mouseYRelative),this.guessButtonClicked()):i.timeLimitDisplay.innerText=(a/1e3).toFixed(2)}if(this.blurredModeEnabled)if(this.blurTimeRemaining>0){this.blurTimeRemaining-=e;const a=this.totalBlurTime,s=1-Math.max(0,this.blurTimeRemaining)/a,n=(1-(1-Math.pow(1-s,4)))*100;i.locationImgElement.style.filter=`blur(${n}px)`}else i.locationImgElement.style.filter="blur(0px)"}else i.locationImgElement.style.filter="";if(window.debugMode){i.debugWindow.style.display="block";const{camera:a,mousePos:s,mouseXRelative:o,mouseYRelative:n,guessPosition:c,fps:l}=p,h={"Game State":`${Object.keys(u).find(f=>u[f]===this.gameState)} (${this.gameState})`,Round:`${this.currentRound}/${this.totalRounds}`,Score:`${this.totalScore} (Round: ${this.roundScore})`,Seed:this.seed,"---":"Map",Cam:`X: ${a.x.toFixed(2)}, Y: ${a.y.toFixed(2)}`,Zoom:a.zoom.toFixed(3),Mouse:`X: ${s.x}, Y: ${s.y}`,"Rel Mouse":`X: ${o.toFixed(2)}, Y: ${n.toFixed(2)}`,Guess:c?`X: ${c.x.toFixed(2)}, Y: ${c.y.toFixed(2)}`:"null",Correct:this.currentLocation?`X: ${this.currentLocation[0]}, Y: ${this.currentLocation[1]}`:"null",FPS:l.toFixed(1),TotalLocations:Object.values(this.gameModeData).reduce((f,m)=>f+m.locations.length,0)};i.debugText.textContent=Object.entries(h).map(([f,m])=>f==="---"?m:`${f.padEnd(10," ")}: ${m}`).join(`
`)}else i.debugWindow.style.display="none";p.draw(),b.gameState===u.gameMenu?i.newGameButton.style.display="none":i.newGameButton.style.display="block",requestAnimationFrame(()=>b.gameLoop())},addEventListeners(){if(console.log("GameManager: Adding Event Listeners..."),!i.difficultySelector){console.error("DOM elements not initialized. Call initializeDOMElements() first.");return}try{document.getElementById("packSelectBackButton").addEventListener("click",()=>{v.open("options")}),i.difficultySelector.addEventListener("change",()=>{i.difficultySelector.value==="custom"?i.customDifficultyDiv.style.display="flex":i.customDifficultyDiv.style.display="none",this.saveOptionsToLocalStorage()}),i.roundCountInput.addEventListener("input",()=>{this.saveOptionsToLocalStorage(),this.updateRoundCounter()}),i.roundCountInput.addEventListener("input",()=>{this.saveOptionsToLocalStorage(),this.validaiteForm()}),i.timerLengthInput.addEventListener("change",()=>{this.saveOptionsToLocalStorage(),this.validaiteForm()}),i.minDifficultyInput.addEventListener("input",t=>{i.minDifficultyValue.textContent=t.target.value}),i.maxDifficultyInput.addEventListener("input",t=>{i.maxDifficultyValue.textContent=t.target.value}),i.guessButton.addEventListener("click",this.guessButtonClicked.bind(this)),i.minimiseButton.addEventListener("click",()=>{this.toggleMinimise()}),i.timeLimitEnabled.addEventListener("change",()=>{this.validaiteForm(),this.saveOptionsToLocalStorage()}),i.minDifficultyInput.addEventListener("input",()=>{this.validaiteForm(),this.saveOptionsToLocalStorage()}),i.maxDifficultyInput.addEventListener("input",()=>{this.validaiteForm(),this.saveOptionsToLocalStorage()}),i.mainMenuButton?i.mainMenuButton.addEventListener("click",()=>window.location.href="index.html"):console.error("Main Menu Button not found!"),document.getElementById("playAgainButton")&&document.getElementById("playAgainButton").addEventListener("click",this.restartGame.bind(this)),i.startButton&&i.startButton.addEventListener("click",this.restartGame.bind(this)),i.newGameButton?(console.log("Attaching listener to newGameButton (using onclick)"),i.newGameButton.onclick=async()=>{if(console.log("End Game Button Clicked. GameState:",this.gameState),this.gameState===u.guessing||this.gameState===u.guessed){console.log("Showing confirmation dialog...");const t=await this.showConfirmationDialog("Return to menu? Your current game progress will be lost.");console.log("Confirmation result:",t),t&&(window.location.href="index.html")}else console.log("GameState is not guessing/guessed. Redirecting immediately."),window.location.href="index.html"}):console.error("newGameButton not found!"),i.changePacksButton.addEventListener("click",()=>v.open("packChoices")),this._focusInHandler&&document.addEventListener("focusin",this._focusInHandler),document.getElementById("fullscreenButton").addEventListener("click",()=>this.toggleFullscreen()),document.addEventListener("keypress",this.handleKeyPress.bind(this)),i.changePacksButton.addEventListener("click",()=>{v.open("packChoices")}),console.log("GameManager: Event Listeners Added Successfully.")}catch(t){console.error("Error in addEventListeners:",t)}},handleKeyPress(t){t.code==="Space"&&this.guessButtonClicked(),t.key==="f"&&this.toggleFullscreen(),t.key==="m"&&this.toggleMinimise(),t.key==="~"&&(window.debugMode=!window.debugMode)},async restartGame(){var c,l,d,h,f,m;if(this.speedrunTimer.currentLocationTime=0,this.speedrunTimer.totalTime=0,this.lastFrameTime=0,this.saveOptionsToLocalStorage(),this.updateRoundCounter(),this.minDifficulty=Number(i.customDifficultyDiv.querySelector("#minDifficulty").value),this.maxDifficulty=Number(i.customDifficultyDiv.querySelector("#maxDifficulty").value),this.timeLimitEnabled=i.timeLimitEnabled.checked,this.timeLimitEnabled){const g=Number(i.timerLengthInput.value),L=[5,10,30];this.timerLengthSeconds=L.includes(g)?g:30,console.log(`[restartGame] Timer enabled. Length set to: ${this.timerLengthSeconds}`)}else console.log("[restartGame] Timer disabled.");this.blurredModeEnabled=!1;const t=r("mapLoadingText");t&&(t.style.display="block"),(c=i.modalOverlay)==null||c.classList.add("visible"),document.body.classList.add("modal-open");const e=w.getSelected();if(e.length===0)return console.error("No game mode selected, cannot start game"),!1;const a=e.map(g=>this.gameModeData[g]).filter(Boolean);if(a.length===0)return console.error("No valid game modes selected, cannot start game"),!1;v.close(),this.totalBlurTime=0;const s=a[0],o=(l=s.map)!=null&&l.useCustomMap&&((d=s.map)!=null&&d.mapUrl)?s.map.mapUrl:((h=s.map)==null?void 0:h.defaultMap)||R;await p.changeMapImage(o,()=>{var T,E,x,y;const g=((T=i.gameOptionsWindow)==null?void 0:T.classList.contains("visible"))||((E=i.gameOverWindow)==null?void 0:E.classList.contains("visible")),L=((x=r("loadingText"))==null?void 0:x.style.display)!=="none",M=(t==null?void 0:t.style.display)!=="none";!g&&!L&&!M&&((y=i.modalOverlay)==null||y.classList.remove("visible"),document.body.classList.remove("modal-open"))});let n=(Date.now()^Math.floor(Math.random()*4294967295))>>>0>>>0;this.seed=String(n);try{this.rng=Q(this.seed)}catch(g){console.warn("Failed to create seeded RNG, falling back to Math.random",g),this.rng=null}try{const g=i.difficultySelector.value;this.currentDifficulty=g,console.log(`[restartGame] Selected Difficulty: ${this.currentDifficulty}`),this.playOrders={},this.playOrderPointers={},this.combinedPlayOrder=[];for(const L of a){const M=this.filterByDifficulty(L.locations,g);if(!M||M.length===0){console.warn(`No valid locations for ${L.name} in selected difficulty.`);continue}const T=M.map(x=>L.locations.indexOf(x)),E=(f=this.rng)!=null&&f.shuffle?this.rng.shuffle(T.slice()):T.sort(()=>Math.random()-.5);this.playOrders[L.id]=E,this.playOrderPointers[L.id]=0;for(const x of E)this.combinedPlayOrder.push({modeId:L.id,index:x})}if(this.combinedPlayOrder.length===0)return console.error("No locations available for the selected modes/difficulty."),!1;this.combinedPlayOrder=(m=this.rng)!=null&&m.shuffle?this.rng.shuffle(this.combinedPlayOrder):this.combinedPlayOrder.sort(()=>Math.random()-.5),this.totalRounds=this.combinedPlayOrder.length,this.currentRound=0}catch(g){console.warn("Failed to build deterministic play order:",g)}return this.totalScore=0,i.guessButton.disabled=!0,i.guessButton.innerText="Guess!",this.nextRound(),!0},updateRoundCounter(){var t=Number(i.roundCountInput.value);(t<=0||isNaN(t))&&(t=i.roundCountInput.placeholder),this.totalRounds=t,i.roundElement.textContent=`${this.currentRound}/${this.totalRounds}`},initializeOptionToggles(){i.gameOptionsWindow.querySelectorAll("[data-toggle-target]").forEach(e=>{const a=e.dataset.toggleTarget,s=r(a);if(!s){console.warn(`Toggle target element with ID "${a}" not found.`);return}const o=()=>{const n=e.checked;s.style.display=n?"flex":"none",e.id==="timeLimitEnabled"&&(i.timeLimitDisplay.style.display=n?"block":"none")};o(),e.addEventListener("change",o)})},toggleFullscreen(){b.gameState!==u.gameMenu&&i.mapContainer.classList.toggle("fullscreen")},toggleMinimise(){i.minimiseIcon.classList.contains("rotate180")?(i.minimiseIcon.classList.remove("rotate180"),i.mapCanvas.classList.remove("minimise"),i.mapContainer.classList.remove("minimise")):(i.minimiseIcon.classList.add("rotate180"),i.mapCanvas.classList.add("minimise"),i.mapContainer.classList.add("minimise"))},guessButtonClicked(){if(!i.guessButton.disabled){if(I.playSound("audio/basic_button.ogg"),this.gameState===u.guessing)this.calculateScore(),this.gameState=u.guessed,i.guessButton.disabled=!1,I.playSound("audio/confirm.ogg"),i.roundScoreDisplay.innerText=`You earned ${this.roundScore} points`,i.roundScoreDisplay.style.display="block",p.guessPosition&&this.currentLocation?p.fitPointsInView(p.guessPosition,{x:this.currentLocation[0],y:this.currentLocation[1]}):this.currentLocation&&p.setCameraTarget(this.currentLocation[0],this.currentLocation[1],1),this.currentRound>=this.totalRounds?(i.guessButton.innerText="End Game",this.gameState=u.gameOver):i.guessButton.innerText="Next Round";else if(this.gameState===u.guessed)this.currentRound<this.totalRounds?(i.mapContainer.classList.remove("fullscreen"),this.nextRound(),i.guessButton.disabled=!0,i.guessButton.innerText="Guess!"):(this.gameState=u.gameOver,this.guessButtonClicked());else if(this.gameState===u.gameOver){i.guessButton.disabled=!0,this.timeLimitEnabled?(i.timerLengthDisplay.style.display="block",i.timerLengthDisplay.innerText=`Timer Length: ${this.timerLengthSeconds}s`):i.timerLengthDisplay.style.display="none",v.open("gameover"),i.finalScoreDisplay.innerText=`Final Score: ${this.totalScore}/${this.totalRounds*this.maxScore}`;const t=(this.totalScore/(this.totalRounds*this.maxScore)*100).toFixed(2);i.accuracyElement.innerText=`Accuracy: ${t}%`,i.totalRoundsElement.innerText=`Total Rounds: ${this.totalRounds}`,this.seed!=null&&(i.seedDisplay.innerText=`Seed: ${this.seed}`);const e=w.getSelected(),a=e.length===1?e[0]:"mixed",s=this.currentDifficulty||"unknown";console.log(`[guessButtonClicked] Saving. Mode: ${a} | Difficulty: ${s}`),Z.saveResult({gameMode:a,difficulty:s,score:this.totalScore,timeTaken:this.speedrunTimer.totalTime/1e3,timeLimit:this.timeLimitEnabled?this.timerLengthSeconds:0,totalRounds:this.totalRounds}).then(o=>{o&&o._id&&(console.log("Game saved to database"),S.displayToast("Score Saved!",3e3))}).catch(o=>console.error(o))}}},setLocation(t,e,a=!0){console.log(`setLocation called: index=${t}, mode=${e}, start=${a}`),this.imageIsLoaded=!1,p.guessPosition=null;const s=this.gameModeData[e];if(!s||!s.locations||t<0||t>=s.locations.length){console.error("Invalid game mode or location index:",{index:t,gameMode:e,modeData:s});return}if(this.currentLocation=s.locations[t],!this.currentLocation||!this.currentLocation[3]){console.error("Invalid current location or image path:",this.currentLocation);return}const o=this.currentLocation[3];console.log("Loading location image:",o),i.locationImgElement.classList.add("hideLocationImg"),r("blurBg").classList.add("hideLocationImg"),i.locationImgElement.style.opacity="0",i.locationImgElement.style.transition="opacity 0.4s ease",r("loadingText").style.display="flex",i.modalOverlay&&i.modalOverlay.classList.add("visible"),document.body.classList.add("modal-open"),i.locationImgElement.onload=null,i.locationImgElement.onerror=null,i.locationImgElement.onload=()=>{console.log(`[onload] Image loaded. shouldStartGame: ${a}`),a&&(console.log("[onload] Setting gameState to GUESSING."),this.gameState=u.guessing,this.speedrunTimer.currentLocationTime=0),r("loadingText").style.display="none",i.locationImgElement.style.display="block",setTimeout(()=>{i.locationImgElement.style.opacity="1",i.locationImgElement.classList.remove("hideLocationImg"),r("blurBg").classList.remove("hideLocationImg")},10);const n=r("mapLoadingText"),c=i.gameOptionsWindow&&i.gameOptionsWindow.classList.contains("visible")||i.gameOverWindow&&i.gameOverWindow.classList.contains("visible"),l=n&&n.style.display!=="none";!c&&!l&&(i.modalOverlay&&i.modalOverlay.classList.remove("visible"),document.body.classList.remove("modal-open")),p.guessPosition&&(i.guessButton.disabled=!1),this.timeLimitEnabled?(this.endTime=performance.now()+this.timerLengthSeconds*1e3,console.log(`[onload] Timer started. EndTime: ${this.endTime}, Length: ${this.timerLengthSeconds}`)):console.log("[onload] Timer not enabled."),this.blurredModeEnabled&&(this.blurTimeRemaining=this.totalBlurTime)},i.locationImgElement.onerror=n=>{console.error("Failed to load location image:",{path:o,error:n}),r("loadingText").style.display="none";const c=r("mapLoadingText"),l=i.gameOptionsWindow&&i.gameOptionsWindow.classList.contains("visible")||i.gameOverWindow&&i.gameOverWindow.classList.contains("visible"),d=c&&c.style.display!=="none";!l&&!d&&(i.modalOverlay&&i.modalOverlay.classList.remove("visible"),document.body.classList.remove("modal-open"))},r("locationImg").src=o,r("blurBg").style.backgroundImage=`url(${o})`},filterByDifficulty(t,e){if(e==="all")return t;if(e==="custom")return t.filter(s=>s[2]>=this.minDifficulty&&s[2]<=this.maxDifficulty);const a=le[e];return a?t.filter(s=>s[2]>=a.min&&s[2]<=a.max):(console.warn("Unknown difficulty selected:",e),t)},async nextRound(){var L,M,T,E,x;i.roundScoreDisplay.style.display="none",p.resetCamera(),this.currentRound++,this.updateRoundCounter();const t=w.getSelected();if(!t||t.length===0){console.error("No game modes selected."),this.endGame();return}const e=i.difficultySelector.value;let a=[];for(const y of t){const D=(L=this.gameModeData[y])==null?void 0:L.locations;if(!D)continue;this.usedLocations[y]||(this.usedLocations[y]=[]);const P=this.filterByDifficulty(D,e),$=this.usedLocations[y],O=P.map((C,A)=>A).filter(C=>!$.includes(C));for(const C of O)a.push({modeId:y,dataList:D,filtered:P,index:C})}if(a.length===0){console.warn("No available locations left. Resetting and repeating locations."),S.displayToast("All unique locations have been used. Locations will now repeat.");for(const y of t)this.usedLocations[y]&&(this.usedLocations[y]=[]);for(const y of t){const D=(M=this.gameModeData[y])==null?void 0:M.locations;if(!D)continue;const P=this.filterByDifficulty(D,e),$=P.map((O,C)=>C);for(const O of $)a.push({modeId:y,dataList:D,filtered:P,index:O})}if(a.length===0){console.error("No locations found for the selected difficulty, even after reset."),this.endGame();return}}let s;if(this.rng){const y=this.rng.randIRange(0,a.length-1);s=a[y]}else{const y=z(0,a.length-1);s=a[y]}const{modeId:o,dataList:n,filtered:c,index:l}=s,d=this.usedLocations[o],h=c[l],f=n.indexOf(h);if(f===-1){console.error(`Location not found in game mode ${o}`),this.endGame();return}d.push(l);const m=this.gameModeData[o],g=(T=m.map)!=null&&T.useCustomMap&&((E=m.map)!=null&&E.mapUrl)?m.map.mapUrl:((x=m.map)==null?void 0:x.defaultMap)||R;p.currentMapUrl!==g?(console.log(`[nextRound] Changing map. Mode: ${o}, NewUrl: ${g}, OldUrl: ${p.currentMapUrl}`),await p.changeMapImage(g)):console.log(`[nextRound] Map unchanged. Mode: ${o}, Url: ${g}`),this.startRoundWithLocation(f,o)},startRoundWithLocation(t,e){this.setLocation(t,e),i.guessButton.disabled=!0,p.guessPosition=null},endGame(){this.gameState=u.gameOver,this.guessButtonClicked()},calculateScore(){if(!p.guessPosition||!this.currentLocation){this.roundScore=0;return}const t=p.guessPosition.x-this.currentLocation[0],e=p.guessPosition.y-this.currentLocation[1],a=Math.sqrt(t*t+e*e),o=Math.round(this.maxScore*Math.exp(-.001*(a-50)));this.roundScore=Math.min(o,this.maxScore),this.totalScore+=this.roundScore},validationToasts:{},showValidationToast(t,e){this.validationToasts[t]||(this.validationToasts[t]=S.displayToast(e,0))},dismissValidationToast(t){this.validationToasts[t]&&(S.dismissToast(this.validationToasts[t]),delete this.validationToasts[t])},async validaiteForm(){let t=!0;if(w.getSelected().length===0?(this.showValidationToast("pack","Please select at least one image pack."),t=!1):this.dismissValidationToast("pack"),i.timeLimitEnabled.checked){const a=Number(i.timerLengthInput.value);a<=0||isNaN(a)?(this.showValidationToast("timer","Timer length must be a number greater than 0."),t=!1):this.dismissValidationToast("timer")}else this.dismissValidationToast("timer");const e=Number(i.roundCountInput.value);if(e<=0||isNaN(e)?(this.showValidationToast("rounds","Rounds must be a number greater than 0."),t=!1):this.dismissValidationToast("rounds"),i.difficultySelector.value==="custom"){const a=Number(i.minDifficultyInput.value),s=Number(i.maxDifficultyInput.value);a<1||a>10||isNaN(a)?(this.showValidationToast("minDiff","Min difficulty must be between 1-10."),t=!1):this.dismissValidationToast("minDiff"),s<1||s>10||isNaN(s)?(this.showValidationToast("maxDiff","Max difficulty must be between 1-10."),t=!1):this.dismissValidationToast("maxDiff"),a>s?(this.showValidationToast("diffRange","Min difficulty cannot be greater than max."),t=!1):this.dismissValidationToast("diffRange")}else this.dismissValidationToast("minDiff"),this.dismissValidationToast("maxDiff"),this.dismissValidationToast("diffRange");t?(i.startButton.style.pointerEvents="auto",i.startButton.style.opacity="1"):(i.startButton.style.pointerEvents="none",i.startButton.style.opacity="0.25")},async handleSeedEasterEggs(t){const e=t.toLowerCase();if(t==="69")S.displayToast("Nice.");else if(e.includes("yalikejazz")){const{egg:a}=await q(async()=>{const{egg:s}=await import("./egg-wjA0cPBO.js");return{egg:s}},[]);S.displayToast(a,1e4,{allowHTML:!0})}else e.includes("biticalifi")?this.showValidationToast("seed","Seed cannot contain cool people."):t==="rickroll"?(S.displayToast("gottem"),window.open("https://www.youtube.com/watch?v=dQw4w9WgXcQ","_blank")):e.includes("squirrel")?S.displayToast("üêøÔ∏è"):e.includes("dawndishsoap")&&S.displayToast('<img src="images/soap.jpeg" style="width:100%; border-radius:8px;" alt="dawn dish soap" />',1200,{allowHTML:!0});return!0},updateSelectedPacksDisplay(){const t=r("selected-packs-list");t&&(t.innerHTML=w.getSelectedOptions().map(e=>{let a="";if(e.gameMapName){let s="images/customPin.png";e.gameMapName==="hallownest"?s="images/knightPin.png":e.gameMapName==="pharloom"&&(s="images/hornetPin.png"),a=`<img src="${s}" class="choice-map-icon" alt="${e.gameMapName} map icon">`}return`<span class="pack-tag">${a}${e.label}</span>`}).join(""))},showConfirmationDialog(t){return new Promise(e=>{i.confirmationMessage.textContent=t;const a=i.confirmationButtons;a.innerHTML="";const s=document.createElement("button");s.className="hk-button",s.textContent="Confirm";const o=document.createElement("button");o.className="hk-button",o.textContent="Cancel",a.append(s,o);const n=c=>{v.close(),e(c)};s.addEventListener("click",()=>n(!0),{once:!0}),o.addEventListener("click",()=>n(!1),{once:!0}),v.open("confirmation")})},saveOptionsToLocalStorage(){localStorage.roundCount=i.roundCountInput.value,localStorage.timerLength=i.timerLengthInput.value,localStorage.timeLimitEnabled=i.timeLimitEnabled.checked,localStorage.minDifficulty=i.minDifficultyInput.value,localStorage.maxDifficulty=i.maxDifficultyInput.value,localStorage.selectedDifficulty=i.difficultySelector.value},loadOptionsFromLocalStorage(){if(localStorage.roundCount&&(i.roundCountInput.value=localStorage.roundCount),this.updateRoundCounter(),localStorage.timerLength&&(["5","10","30"].includes(localStorage.timerLength)?i.timerLengthInput.value=localStorage.timerLength:(i.timerLengthInput.value="30",localStorage.timerLength="30")),localStorage.timeLimitEnabled&&(i.timeLimitEnabled.checked=localStorage.timeLimitEnabled==="true"),localStorage.minDifficulty&&(i.minDifficultyInput.value=localStorage.minDifficulty),localStorage.maxDifficulty&&(i.maxDifficultyInput.value=localStorage.maxDifficulty),localStorage.selectedDifficulty&&(i.difficultySelector.value=localStorage.selectedDifficulty),localStorage.selectedPacks){const t=localStorage.selectedPacks.split(",");for(let e=0;e<t.length;e++)w.selected.add(t[e])}w.render()}};function re(){i.customDifficultyDiv=r("customDifficultyDiv"),i.difficultySelector=r("difficultySelector"),i.roundCountInput=r("roundCount"),i.timerLengthInput=r("timerLength"),i.accuracyElement=r("accuracy"),i.finalScoreDisplay=r("finalScore"),i.gameOverWindow=r("gameOverWindow"),i.gameOptionsWindow=r("gameOptionsWindow"),i.loadingText=r("loadingText"),i.roundElement=r("round"),i.timeLimitDisplay=r("timeLimitDisplay"),i.totalRoundsElement=r("totalRounds"),i.timerLengthDisplay=r("timerLengthDisplay"),i.newGameButton=r("newGameButton"),i.startButton=r("startButton"),i.mainMenuButton=r("mainMenuButton"),i.timeLimitEnabled=r("timeLimitEnabled"),i.minDifficultyInput=r("minDifficulty"),i.maxDifficultyInput=r("maxDifficulty"),i.minDifficultyValue=r("minDifficultyValue"),i.maxDifficultyValue=r("maxDifficultyValue"),i.formWarning=r("formWarning"),i.guessButton=r("guessButton"),i.locationImgElement=r("locationImg"),i.mapCanvas=r("mapCanvas"),i.mapContainer=r("mapContainer"),i.roundScoreDisplay=r("roundScoreDisplay"),i.minimiseButton=r("minimiseButton"),i.gameMode=r("gameMode"),i.minimiseIcon=r("minimiseIcon"),i.fullscreenButton=r("fullscreenButton"),i.timerLengthOption=r("timerLengthOption"),i.modalOverlay=r("modalOverlay"),i.seededIndicator=r("seededIndicator"),i.seedDisplay=r("seedDisplay"),i.packSelectWindow=r("packSelectWindow"),i.packChoices=r("packChoices"),i.confirmationWindow=r("confirmationWindow"),i.confirmationMessage=r("confirmationMessage"),i.confirmationButtons=r("confirmationButtons"),i.changePacksButton=r("changePacksButton"),i.blurredModeEnabled=r("blurredModeEnabled"),i.debugWindow=r("debugWindow"),i.debugText=r("debugText"),i.difficultySelector=r("difficultySelector"),i.timerLengthInput=r("timerLength"),i.roundCountInput=r("roundCount")}function r(t){return document.getElementById(t)}async function _(){console.log("DOM Loaded! Starting Main..."),re(),console.log("DOM Initialized. Loading Initial Data...");try{const t=await ae();console.log("Initial Data Loaded. Initializing GameManager..."),b.init(t)}catch(t){console.error("Failed to load game data:",t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_();
